{% extends 'base.html' %}

{% block content %}
<div class="row justify-content-center mt-4">
    <div class="col-md-6 col-lg-5">

        <div class="card shadow-sm">
            <div class="card-body p-4">

                <h4 class="text-center mb-4">üìù Registro de votantes</h4>

                {% with messages = get_flashed_messages() %}
                  {% if messages %}
                    {% for message in messages %}
                      <div class="alert alert-warning text-center">
                        {{ message }}
                      </div>
                    {% endfor %}
                  {% endif %}
                {% endwith %}

                <form method="POST">

                    <input name="nombre" class="form-control mb-2" placeholder="Nombre completo" required>
                    <input id="cedula" name="cedula" class="form-control mb-2" placeholder="C√©dula" required>
                    <small id="mensajeCedula"></small>
                    <input type="number" name="edad" class="form-control mb-2" placeholder="Edad" required>
                    <input type="number" name="telefono" class="form-control mb-2" placeholder="T√©lefono" required>
                    <input name="ocupacion" class="form-control mb-2" placeholder="Ocupaci√≥n" required>
                    <select name="punto" class="form-control mb-2" required>
        <option value="">Seleccione punto de votaci√≥n</option>
        {% for punto in puntos %}
            <option value="{{ punto.id }}">{{ punto.nombre }}</option>
        {% endfor %}
    </select>
                    <input name="mesa" class="form-control mb-2" placeholder="Mesa de votaci√≥n" required>
                    <input name="lider_r" class="form-control mb-3" placeholder="L√≠der de referencia" required>
    <select name="lider" class="form-control mb-2" required>
        <option value="">Seleccione Lider Principal</option>
        {% for lider in lideres %}
            <option value="{{ lider.id }}">{{ lider.nombre }}</option>
        {% endfor %}
    </select>

                    <div class="d-flex gap-2">
                        <button class="btn btn-success w-100">
                            Guardar votante
                        </button>

                    </div>

                </form>

            </div>
        </div>

    </div>
</div>
<script>
const cedulaInput = document.getElementById('cedula')
const mensaje = document.getElementById('mensajeCedula')

cedulaInput.addEventListener('keyup', () => {
    const cedula = cedulaInput.value.trim()

    if (cedula.length < 5) {
        mensaje.textContent = ''
        return
    }

    fetch(`/validar_cedula?cedula=${cedula}`)
        .then(res => res.json())
        .then(data => {
            if (data.existe) {
                mensaje.textContent = '‚ö†Ô∏è Esta c√©dula ya est√° registrada'
                mensaje.style.color = 'red'
            } else {
                mensaje.textContent = '‚úÖ C√©dula disponible'
                mensaje.style.color = 'green'
            }
        })
})
</script>
{% endblock %}

